<script setup lang="ts">
import { defineAsyncComponent, computed } from 'vue';
import { useRuntimeConfig, useState } from '#imports';
import AboutSection from "~/app/components/Home/About.vue";
import WhyWeSection from "~/app/components/Home/WhyWe.vue";
import FaqSection from "~/app/components/Home/Faq.vue";
import InformationSection from "~/app/components/Home/Information.vue";
import TestimoniSection from "~/app/components/Home/Testimoni.vue";
import BlogListComponent from "~/app/components/BlogList.vue";
import CompanyProfileSection from "~/app/components/Home/CompanyProfile.vue";
import SeoKeywords from "~/app/components/SeoKeywords.vue";
import LazySection from "~/components/LazySection.vue";
import AdvancedLazySection from "~/components/AdvancedLazySection.vue";
import { seoKeywords } from '~/app/utils/seoKeywords'

definePageMeta({ name: 'home' })

const net = useState<{ slow?: boolean; reason?: string }>('net-mode')
const dataSaver = useState<any>('data-saver')

// Lazy-load slider only on client and only when needed (fast network)
const BannerSliderClient = defineAsyncComponent(() => import('../app/components/BannerSlider.vue'))

const { data: page } = await useAsyncData('index', async () => {
  try {
    // Use a more robust approach for content querying
    const content = await queryCollection('content')
    return content?.first() || null
  } catch (error) {
    console.warn('Content query failed during prerendering:', error)
    return null
  }
})

// Network mode detection for banner slider
const showBannerSlider = computed(() => {
  return !net.value?.slow
})

const defaultTitle = 'Jasa Pembayaran Online'
const defaultDescription = 'Layanan pembayaran digital terpercaya.'

useSeoMeta({
  title: page.value?.title || defaultTitle,
  ogTitle: page.value?.title || defaultTitle,
  twitterTitle: page.value?.title || defaultTitle,
  description: page.value?.description || defaultDescription,
  ogDescription: page.value?.description || defaultDescription,
  twitterDescription: page.value?.description || defaultDescription,
});

useHead({
  meta: [
    { name: 'keywords', content: seoKeywords.join(', ') }
  ]
});

// WhatsApp CTA runtime link
const config = useRuntimeConfig();
const whatsappPhone = computed(() => config.public?.whatsappPhone || '628988888250');
const whatsappMessage = computed(
  () => config.public?.whatsappMessage || 'Halo JasaPembayaran.com, saya ingin konsultasi tentang jasa PayPal'
);
const whatsappHref = computed(() => {
  const params = new URLSearchParams({
    phone: String(whatsappPhone.value),
    text: String(whatsappMessage.value),
    type: 'phone_number',
    app_absent: '0'
  });
  return `https://api.whatsapp.com/send/?${params.toString()}`;
});
</script>

<template>
  <div class="relative mobile-page-wrapper" :style="{ paddingTop: 'var(--app-header-offset, 56px)', margin: '0 auto', width: '100%', maxWidth: '100%' }" :data-net-mode="(net && net.slow) ? 'slow' : 'fast'">
    <div class="relative z-0 shadow-md mb-3 md:mb-0 hero-offset banner-container">
      <ClientOnly>
        <template v-if="showBannerSlider">
          <component :is="BannerSliderClient" />
        </template>
        <template v-else>
          <div class="banner-slider-fallback">
            <div class="carousel"></div>
          </div>
        </template>
        <template #fallback>
          <div class="banner-slider-fallback">
            <div class="carousel"></div>
          </div>
        </template>
      </ClientOnly>
    </div>

    <!-- Butuh Bantuan Section - REBUILD CLEAN -->
    <div class="bantuan-section mt-3">
      <div class="bantuan-card bg-gradient-to-r from-emerald-500/20 via-cyan-500/20 to-indigo-600/20 dark:from-emerald-400/20 dark:via-cyan-400/20 dark:to-indigo-400/20 backdrop-blur-xl rounded-2xl py-3 sm:py-4 px-4 sm:px-5 flex flex-col md:flex-row items-center justify-between gap-3 shadow-2xl border border-emerald-400/30 ring-1 ring-emerald-300/20 transition-all duration-300 hover:border-emerald-300/40">
        <div class="flex items-center gap-2 sm:gap-3">
          <div class="bg-gradient-to-br from-green-500 to-green-700 rounded-full w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center shadow-xl">
            <img src="/icons/whatsapp-neo.svg" alt="WhatsApp" class="w-4 h-4 sm:w-5 sm:h-5" loading="lazy" />
          </div>
          <div class="text-slate-900 dark:text-white">
            <h3 class="font-semibold text-sm sm:text-base leading-tight">Butuh bantuan?</h3>
            <p class="text-slate-700 dark:text-white/80 text-xs sm:text-sm">Konsultasi cepat dengan tim kami</p>
          </div>
        </div>
        <NuxtLink
          :to="whatsappHref"
          target="_blank"
          aria-label="Hubungi kami via WhatsApp"
          class="bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 !text-white px-4 py-2 sm:px-5 sm:py-2.5 rounded-full font-semibold text-xs sm:text-sm transition-all duration-300 flex items-center gap-2 w-full md:w-auto justify-center shadow-lg hover:shadow-xl ring-1 ring-white/20"
        >
          <img src="/icons/whatsapp-neo.svg" alt="WhatsApp" class="w-4 h-4" loading="lazy" />
          Hubungi Kami via WhatsApp
        </NuxtLink>
      </div>
    </div>

    <!-- Trusted Partners Section dengan Spacing Fix -->
    <div class="trusted-partners-section">
      <ClientOnly>
        <LazyTrustedPartners :hydrate-on-visible="{ rootMargin: '0px 0px 600px 0px' }" />
      </ClientOnly>
    </div>
    
    <!-- Jasa PayPal Section dengan Spacing Fix -->
    <div class="about-section">
      <AboutSection />
    </div>

    <!-- Main Content Container -->
    <div class="w-full pt-0 pb-0 flex flex-col relative z-0 overflow-visible">

      <AdvancedLazySection 
        rootMargin="0px 0px 400px 0px" 
        minHeight="320px" 
        priority="medium"
        animation="fade"
        placeholder="skeleton"
        class="mt-0"
      >
        <CompanyProfileSection class="mt-0" />
      </AdvancedLazySection>

      <AdvancedLazySection 
        rootMargin="0px 0px 400px 0px" 
        minHeight="300px" 
        priority="medium"
        animation="slide"
        placeholder="skeleton"
        class="mt-0"
      >
        <InformationSection />
      </AdvancedLazySection>

      <AdvancedLazySection 
        rootMargin="0px 0px 400px 0px" 
        minHeight="300px" 
        priority="medium"
        animation="scale"
        placeholder="skeleton"
        class="mt-0"
      >
        <WhyWeSection class="mt-0" />
      </AdvancedLazySection>

      <AdvancedLazySection 
        rootMargin="0px 0px 400px 0px" 
        minHeight="380px" 
        priority="low"
        animation="fade"
        placeholder="skeleton"
        delay="200"
        class="mt-0 mb-6 md:mb-10 lg:mb-14"
      >
        <!-- Testimonial section as full-width -->
        <TestimoniSection />
      </AdvancedLazySection>

      <AdvancedLazySection 
        rootMargin="0px 0px 400px 0px" 
        minHeight="320px" 
        priority="low"
        animation="slide"
        placeholder="skeleton"
        delay="300"
        class="mt-0"
      >
        <FaqSection class="mt-0 -mx-2 sm:mx-0" />
      </AdvancedLazySection>

      <!-- Blog Articles Section with Epic Header -->
      <section class="w-full px-4 sm:px-6 lg:px-8 py-12 md:py-16 relative overflow-hidden">
        <!-- Background Decorations -->
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-gradient-to-br from-blue-500/10 via-cyan-500/10 to-indigo-500/10 dark:from-blue-400/5 dark:via-cyan-400/5 dark:to-indigo-400/5 rounded-full blur-3xl -z-10"></div>
        <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-gradient-to-tl from-purple-500/10 via-pink-500/10 to-rose-500/10 dark:from-purple-400/5 dark:via-pink-400/5 dark:to-rose-400/5 rounded-full blur-3xl -z-10"></div>
        
        <!-- Section Header -->
        <div class="max-w-7xl mx-auto mb-12 text-center relative">
          <!-- Decorative line top -->
          <div class="flex items-center justify-center mb-6">
            <div class="h-px w-16 bg-gradient-to-r from-transparent via-blue-500 to-transparent"></div>
            <div class="mx-4 px-6 py-2 bg-gradient-to-r from-blue-500/10 via-cyan-500/10 to-indigo-500/10 dark:from-blue-400/10 dark:via-cyan-400/10 dark:to-indigo-400/10 rounded-full backdrop-blur-sm border border-blue-200/30 dark:border-blue-700/30">
              <span class="text-sm font-bold bg-gradient-to-r from-blue-600 via-cyan-600 to-indigo-600 dark:from-blue-400 dark:via-cyan-400 dark:to-indigo-400 bg-clip-text text-transparent">
                ðŸ“š BLOG & ARTIKEL
              </span>
            </div>
            <div class="h-px w-16 bg-gradient-to-r from-transparent via-blue-500 to-transparent"></div>
          </div>
          
          <!-- Main Title -->
          <h2 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-black mb-4 relative">
            <span class="bg-gradient-to-r from-blue-600 via-cyan-600 to-indigo-600 dark:from-blue-400 dark:via-cyan-400 dark:to-indigo-400 bg-clip-text text-transparent drop-shadow-lg">
              Artikel & Tips Terbaru
            </span>
            <div class="absolute -top-2 -right-2 w-20 h-20 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full blur-2xl opacity-20 animate-pulse"></div>
          </h2>
          
          <!-- Subtitle -->
          <p class="text-base sm:text-lg md:text-xl text-slate-600 dark:text-slate-300 max-w-3xl mx-auto leading-relaxed font-medium">
            Temukan panduan lengkap, tips praktis, dan informasi terkini seputar 
            <span class="font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-600 dark:from-blue-400 dark:to-cyan-400">pembayaran online</span>, 
            <span class="font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 dark:from-purple-400 dark:to-pink-400">PAYTECH</span>, dan 
            <span class="font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-600 dark:from-emerald-400 dark:to-teal-400">teknologi finansial</span>
          </p>
          
          <!-- Stats Cards -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8 max-w-4xl mx-auto">
            <!-- Total Articles -->
            <div class="bg-gradient-to-br from-white via-blue-50/50 to-cyan-50/50 dark:from-slate-800 dark:via-blue-900/20 dark:to-cyan-900/20 rounded-2xl p-4 border border-blue-200/50 dark:border-blue-700/30 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105">
              <div class="text-2xl md:text-3xl font-black bg-gradient-to-r from-blue-600 to-cyan-600 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent mb-1">
                500+
              </div>
              <div class="text-xs md:text-sm font-semibold text-slate-600 dark:text-slate-400">
                Artikel
              </div>
            </div>
            
            <!-- Categories -->
            <div class="bg-gradient-to-br from-white via-purple-50/50 to-pink-50/50 dark:from-slate-800 dark:via-purple-900/20 dark:to-pink-900/20 rounded-2xl p-4 border border-purple-200/50 dark:border-purple-700/30 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105">
              <div class="text-2xl md:text-3xl font-black bg-gradient-to-r from-purple-600 to-pink-600 dark:from-purple-400 dark:to-pink-400 bg-clip-text text-transparent mb-1">
                15+
              </div>
              <div class="text-xs md:text-sm font-semibold text-slate-600 dark:text-slate-400">
                Kategori
              </div>
            </div>
            
            <!-- Readers -->
            <div class="bg-gradient-to-br from-white via-emerald-50/50 to-teal-50/50 dark:from-slate-800 dark:via-emerald-900/20 dark:to-teal-900/20 rounded-2xl p-4 border border-emerald-200/50 dark:border-emerald-700/30 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105">
              <div class="text-2xl md:text-3xl font-black bg-gradient-to-r from-emerald-600 to-teal-600 dark:from-emerald-400 dark:to-teal-400 bg-clip-text text-transparent mb-1">
                50K+
              </div>
              <div class="text-xs md:text-sm font-semibold text-slate-600 dark:text-slate-400">
                Pembaca
              </div>
            </div>
            
            <!-- Updates -->
            <div class="bg-gradient-to-br from-white via-orange-50/50 to-red-50/50 dark:from-slate-800 dark:via-orange-900/20 dark:to-red-900/20 rounded-2xl p-4 border border-orange-200/50 dark:border-orange-700/30 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105">
              <div class="text-2xl md:text-3xl font-black bg-gradient-to-r from-orange-600 to-red-600 dark:from-orange-400 dark:to-red-400 bg-clip-text text-transparent mb-1">
                Daily
              </div>
              <div class="text-xs md:text-sm font-semibold text-slate-600 dark:text-slate-400">
                Update
              </div>
            </div>
          </div>
          
          <!-- CTA Button -->
          <div class="mt-8">
            <NuxtLink 
              to="/blog"
              class="inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-blue-600 via-cyan-600 to-indigo-600 hover:from-blue-700 hover:via-cyan-700 hover:to-indigo-700 text-white font-bold rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-105 border border-white/20"
            >
              <span>Lihat Semua Artikel</span>
              <svg class="w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
              </svg>
            </NuxtLink>
          </div>
        </div>
        
        <!-- Blog List Component -->
        <AdvancedLazySection 
          rootMargin="0px 0px 400px 0px" 
          minHeight="500px" 
          priority="low"
          animation="fade"
          placeholder="skeleton"
          delay="400"
          class="mt-0"
        >
          <BlogListComponent mode="home" :limit="8" class="mt-0" />
        </AdvancedLazySection>
      </section>
      
      <AdvancedLazySection 
        rootMargin="0px 0px 400px 0px" 
        minHeight="200px" 
        priority="low"
        animation="scale"
        placeholder="skeleton"
        delay="500"
        class="mt-4"
      >
        <SeoKeywords class="mt-4" />
      </AdvancedLazySection>
    </div>
  </div>
</template>

<style scoped>
/* Custom animation for WhatsApp icon */
@keyframes pulse-subtle {
  0% {
    transform: scale(1);
    filter: brightness(1);
  }
  50% {
    transform: scale(1.05);
    filter: brightness(1.1);
  }
  100% {
    transform: scale(1);
    filter: brightness(1);
  }
}

.animate-pulse-subtle {
  animation: pulse-subtle 3s ease-in-out infinite;
}

/* Enhanced hover effect for WhatsApp container */
.whatsapp-button-container {
  position: relative;
  overflow: hidden;
}

.whatsapp-button-container::after {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.whatsapp-button-container:hover::after {
  opacity: 1;
}

/* Clean banner fallback without gradient border */
.banner-slider-fallback {
  width: 100%;
  height: 60vh;
  min-height: 500px;
  max-height: 650px;
  position: relative;
  overflow: hidden;
  border-radius: 24px;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  border: 2px solid #e2e8f0;
}
/* Removed overlay for cleaner appearance */
.banner-slider-fallback .carousel {
  width: 100%;
  height: 100%;
  display: block;
  border-radius: inherit;
}
/* Responsive fallback banner */
@media (max-width: 1200px) {
  .banner-slider-fallback {
    height: 55vh;
    min-height: 450px;
    max-height: 550px;
    border-radius: 20px;
  }
}

@media (max-width: 1024px) {
  .banner-slider-fallback {
    height: 50vh;
    min-height: 400px;
    max-height: 500px;
    border-radius: 18px;
  }
}

@media (max-width: 768px) {
  .banner-slider-fallback {
    height: 45vh;
    min-height: 350px;
    max-height: 450px;
    border-radius: 16px;
  }
}

@media (max-width: 640px) {
  .banner-slider-fallback {
    height: 40vh;
    min-height: 300px;
    max-height: 400px;
    border-radius: 14px;
  }
}

@media (max-width: 480px) {
  .banner-slider-fallback {
    height: 35vh;
    min-height: 280px;
    max-height: 350px;
    border-radius: 12px;
  }
}

@media (max-width: 360px) {
  .banner-slider-fallback {
    height: 32vh;
    min-height: 250px;
    max-height: 300px;
    border-radius: 10px;
  }
}

</style>



<style scoped>
/* Mobile-adjusted header offset for banner wrapper */
.hero-offset {
  margin-top: 0; /* Remove negative margin to prevent running up */
}
@media (max-width: 640px) {
  .hero-offset {
    margin-top: 0 !important; /* Remove negative margin to prevent running up */
  }
}

/* Clean banner container without gradient border */
.banner-container {
  background: transparent;
  padding: 0;
  border-radius: 0;
  margin: 0 auto; /* Center container */
  position: relative;
  overflow: visible;
  width: 100%;
  max-width: 100%;
}

/* Clean styling - no gradients or overlays */

/* Simple & Direct Spacing - No Complex CSS */

/* Responsive padding - Konsisten untuk semua section */

/* Base styles untuk semua wrapper */
.banner-container,
.bantuan-section,
.trusted-partners-section,
.about-section {
  margin: 0 auto !important;
  width: 100% !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
  overflow: visible !important;
}

.bantuan-section {
  margin: 24px 0 !important; /* tighter spacing */
}

.bantuan-section > div {
  width: 100% !important;
  box-sizing: border-box !important;
}

/* Mobile alignment tweak: shift bantuan card slightly right for precision */
/* Bantuan card: reset all custom margins and let parent handle padding */
@media (max-width: 767px) {
  .mobile-page-wrapper .bantuan-section .bantuan-card {
    margin: 0 !important;
    width: 100% !important;
    padding-left: 1rem !important;
    padding-right: 1rem !important;
  }
}

@media (min-width: 768px) {
  .bantuan-section .bantuan-card {
    max-width: 980px !important;
    margin-inline: auto !important;
  }
}

.trusted-partners-section,
.about-section {
  margin: 32px 0 !important; /* tighter spacing */
  padding: 20px 0 !important;
}

/* Mobile - Semua section dengan padding konsisten */
@media (max-width: 767px) {
  .mobile-page-wrapper {
    padding-left: 1rem !important;
    padding-right: 1rem !important;
  }
  
  .banner-container,
  .bantuan-section,
  .trusted-partners-section,
  .about-section {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}

/* Desktop - Padding normal */
@media (min-width: 768px) {
  .banner-container,
  .bantuan-section,
  .trusted-partners-section,
  .about-section {
    padding-left: 1rem !important;
    padding-right: 1rem !important;
  }
}

/* Large Desktop - Lebih besar */
@media (min-width: 1024px) {
  .banner-container,
  .bantuan-section,
  .trusted-partners-section,
  .about-section {
    padding-left: 1.5rem !important;
    padding-right: 1.5rem !important;
  }
}
</style>

